<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Reflection Benchmark</title>
</head>

<body>
	<main>
		<h1>JSON Parser Benchmark</h1>
		<form action="" id="form">
			<div>
				<label for="name">String</label>
				<input type="text" id="name" name="name" required value="Hello World" />

			</div>
			<div>
				Boolean:
				<select name="boolean" id="boolean" form="form">
					<option value="false">False</option>
					<option value="true">True</option>
				</select>
			</div>
			<div>
				Sent to Rust server:
				<button type="submit" name="serde">Using Serde</button>
				<button type="submit" name="reflection">Using Reflection</button>
			</div>
		</form>
		<hr />
		<div id="rtt_container"></div>
		<div id="handle_time_container"></div>
	</main>
</body>
<script>
	function fmtNumber(n) {
		return n.toLocaleString(undefined, {minumumFactionDigits: 3})
	}
	async function logSubmit(event) {
		event.preventDefault();
		const route = event.submitter.name
		const name = event.target[1].value
		const boolean = event.target[2].value === 'true'
		const payload = {name, boolean}
		const str_payload = JSON.stringify(payload)
		const startTime = performance.now()
		const res = await fetch("/" + route, {
			method: "POST",
			body: str_payload
		})
		const endTime = performance.now()
		const {computationTime} = await res.json()
		document.getElementById("rtt_container").textContent = `Round trip time: ${fmtNumber(endTime - startTime)} ms`

		document.getElementById("handle_time_container").textContent = `Server's handler execution time: ${fmtNumber(computationTime * 1000)}ms`
	}

	const form = document.getElementById("form");
	form.addEventListener("submit", logSubmit);
</script>

</html>
